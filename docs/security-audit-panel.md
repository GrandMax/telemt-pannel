# Аудит безопасности панели MTProxy

Проверка кода панели (бэкенд, фронтенд, Docker, install.sh) на типичные уязвимости.

## Зависимости

- **pip-audit:** Выполнять в `panel/backend`: `pip-audit`. Критичные/высокие в коде приложения устранять. На момент аудита: CVE в Starlette (0.46.x) — исправление в 0.49.1; текущий FastAPI 0.115 требует starlette<0.47, поэтому обновление Starlette отложено до выхода совместимой версии FastAPI. CVE в pip касаются установщика, не рантайма.
- **npm audit:** В `panel/frontend`: `npm audit`. Критичные/высокие — устранить обновлением зависимостей.

## Бэкенд (Python/FastAPI)

- **SQL-инъекции:** Запросы через SQLAlchemy ORM (фильтры, сессии), параметризованные запросы; сырой SQL не используется.
- **Аутентификация:** JWT (PyJWT), пароли хешируются bcrypt. SECRET_KEY — из переменных окружения, не в коде.
- **Авторизация:** Эндпоинты защищены `get_current_admin`; sudo проверяется через `require_sudo` где нужно.
- **Секреты:** Нет захардкоженных ключей; .env в .gitignore.
- **CORS:** Настроен в приложении (allow_origins при необходимости сузить для продакшена).
- **Rate limiting:** На `/api/admin/token` не реализован; рекомендуется вынести за приложение (nginx/трафик) или добавить middleware.

## Фронтенд (React/TypeScript)

- **XSS:** Ввод отображается через React (экранирование по умолчанию); нет опасного `dangerouslySetInnerHTML` с пользовательскими данными.
- **CSRF:** Используется JWT в заголовке, не cookie-based auth — классический CSRF по cookie не применим.
- **Секреты:** Секреты/ключи не попадают в клиентский бандл.

## Инфраструктура (Docker)

- **Контейнеры:** Panel и telemt под non-root пользователями; read_only и cap_drop у telemt.
- **Volumes:** config.toml в общем volume между panel и telemt; panel-data для SQLite — не экспонируется наружу.
- **install.sh:** PANEL_SECRET_KEY генерируется через `openssl rand -hex 32`.

## Итог

- Критичные и высокие уязвимости в коде не допускаются; зависимости — по результатам pip-audit и npm audit.
- Средние (например, отсутствие rate limit на логин) допускаются с пометкой в документации и рекомендацией усилить в продакшене (прокси/фаервол).
